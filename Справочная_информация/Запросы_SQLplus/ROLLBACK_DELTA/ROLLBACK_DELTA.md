---
layout: default
title: ROLLBACK DELTA
nav_order: 28
parent: Запросы SQL+
grand_parent: Справочная информация
has_children: false
has_toc: false
---

# ROLLBACK DELTA

Запрос позволяет откатить горячую [дельту](../../../Обзор_понятий_компонентов_и_связей/Основные_понятия/Дельта/Дельта.md) — 
вернуть [логическую базу данных](../../../Обзор_понятий_компонентов_и_связей/Основные_понятия/Логическая_база_данных/Логическая_база_данных.md) 
в состояние, которое предшествовало изменениям этой дельты. При откате отменяются все операции записи горячей 
дельты: как завершенные успешно или неуспешно, так и еще не завершенные. Подробнее о порядке отката см. 
в секции [Порядок отката горячей дельты](#порядок-отката-горячей-дельты).

Перед выполнением запроса необходимо определить логическую базу данных, [используемую по умолчанию](../../../Работа_с_системой/Другие_функции/Определение_логической_БД_по_умолчанию/Определение_логической_БД_по_умолчанию.md), 
если она еще не определена.

**Примечание:** откат закрытой дельты невозможен.

В ответе возвращается:
*   объект ResultSet c одной записью, содержащей номер последней закрытой дельты, при успешном выполнении 
    запроса;
*   исключение при неуспешном выполнении запроса.

При успешном выполнении запроса все изменения данных горячей дельты отменяются и зарезервированный ранее 
номер горячей дельты освобождается; номер последней закрытой дельты не изменяется.

## Синтаксис

```sql
ROLLBACK DELTA
```

## Порядок отката горячей дельты

Горячая дельта откатывается в следующем порядке:
1. Отменяются изменения по неуспешным операциям записи: 
   1. Выбираются операции записи дельты, которые завершились с ошибкой и которые система не смогла отменить 
   сразу при получении ошибки (например, из-за неполадок в сети).
   2. Отменяются все изменения данных, внесенные выбранными операциями записи.
2. Отменяются изменения по успешным и остановленным операциям записи:
   1. Останавливаются операции записи дельты, которые еще не завершились. <br>Операции записи останавливаются 
      в асинхронном режиме, и система периодически проверяет, остались ли незавершенные операции. Периодичность 
      проверки зависит от [конфигурации](../../../Эксплуатация/Конфигурация/Конфигурация.md) (см. параметр <>); 
      по умолчанию проверка запускается раз в <> секунд. Если незавершенных операций не осталось, система 
      переходит к следующему этапу.
   2. Выбираются операции записи дельты, которые завершились успешно или были остановлены.
   3. Отменяются все изменения данных, внесенные выбранными операциями записи.
3. Горячая дельта удаляется из [сервисной базы данных](../../../Обзор_понятий_компонентов_и_связей/Основные_понятия/Сервисная_база_данных/Сервисная_база_данных.md), 
   и зарезервированный ранее номер горячей дельты освобождается.