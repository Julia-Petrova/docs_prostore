---
layout: default
title: SELECT
nav_order: 30
parent: Запросы SQL+
grand_parent: Справочная информация
has_children: false
has_toc: false
---

# SELECT
{: .no_toc }

<details markdown="block">
  <summary>
    Содержание раздела
  </summary>
  {: .text-delta }
1. TOC
{:toc}
</details>

Запрос позволяет выбрать данные из [логических таблиц](../../../Обзор_понятий_компонентов_и_связей/Основные_понятия/Логическая_таблица/Логическая_таблица.md), 
[логических представлений](../../../Обзор_понятий_компонентов_и_связей/Основные_понятия/Логическое_представление/Логическое_представление.md) 
и (или) [материализованных представлений](../../../Обзор_понятий_компонентов_и_связей/Основные_понятия/Материализованное_представление/Материализованное_представление.md). 
Запрос можно использовать как самостоятельный запрос для [чтения данных](../../../Работа_с_системой/Запрос_данных/Запрос_данных.md), 
а также в качестве подзапроса в следующих запросах:
*   в [запросе на выгрузку данных](../INSERT_INTO_download_external_table/INSERT_INTO_download_external_table.md),
*   в запросе на [создание](../CREATE_VIEW/CREATE_VIEW.md) или [обновление](../ALTER_VIEW/ALTER_VIEW.md) логического представления,
*   в запросе на [создание материализованного представления](../CREATE_MATERIALIZED_VIEW/CREATE_MATERIALIZED_VIEW.md).

С помощью запроса можно выбрать данные любой из категорий:
*   актуальные данные;
*   архивные данные, которые были актуальны в указанный момент времени;
*   изменения данных, выполненные в рамках указанного диапазона [дельт](../../../Обзор_понятий_компонентов_и_связей/Основные_понятия/Дельта/Дельта.md).

Запрос обрабатывается в порядке, описанном в разделе [Порядок обработки запросов на чтение данных](../../../Обзор_понятий_компонентов_и_связей/Связи_с_другими_системами_и_компонентами/Порядок_обработки_запросов_на_чтение_данных/Порядок_обработки_запросов_на_чтение_данных.md).

В ответе возвращается:
*   объект ResultSet c выбранными записями при успешном выполнении запроса;
*   исключение при неуспешном выполнении запроса.

## Синтаксис

```sql
SELECT column_list
FROM [db_name.]entity_name
[FOR SYSTEM_TIME time_expression [AS alias_name]]
[DATASOURCE_TYPE = datasource_alias]
```

Где:
*   `column_list` — список выбираемых столбцов таблицы или представления. Можно указывать символ `*`
    для выбора всех столбцов;
*   `db_name` — имя логической базы данных, из которой выбираются данные. Указывается опционально, если
    выбрана логическая БД, [используемая по умолчанию](../../../Работа_с_системой/Другие_функции/Определение_логической_БД_по_умолчанию/Определение_логической_БД_по_умолчанию.md);
*   `entity_name` — имя таблицы или представления, из которого выбираются данные;
*   `time_expression` — выражение, задающее момент или период времени, за который выбираются
    данные или изменения данных. Синтаксис выражения см. [ниже](#sect_for_system_time);
*   `alias_name` — псевдоним таблицы или представления. Может включать латинские буквы, цифры и символы
    подчеркивания;
*   `datasource_alias` — системный псевдоним СУБД хранилища, из которой выбираются данные. Возможные
    значения: `'adb'`, `'adqm'`, `'adg'`.

В запросах можно указывать: 
* ключевые слова, перечисленные в секции [Поддерживаемые ключевые слова](#поддерживаемые-ключевые-слова), 
* функции, перечисленные в разделе [Поддержка SQL](../../Поддержка_SQL/Поддержка_SQL.md),
* псевдонимы для имен таблиц, представлений и столбцов.

**Примечание:** некоторые агрегатные функции и типы соединений недоступны для исполнения в определенных
СУБД хранилища. Список доступных возможностей см. в разделе [Поддержка SQL](../../Поддержка_SQL/Поддержка_SQL.md).

### Поддерживаемые ключевые слова
    
В запросе можно использовать следующие ключевые слова, которые должны быть указаны в порядке их перечисления:
1.   `FOR SYSTEM_TIME` — для указания момента времени или периода, за который выбираются данные или 
    изменения данных. Если ключевое слово не указано, из логической таблицы и логического представления 
    выбираются данные, актуальные на момент обработки запроса, из материализованного представления  
    — данные, актуальные на момент последней синхронизации представления;
2.   `JOIN ON` — для соединения данных нескольких логических таблиц и (или) представлений из одной или
     нескольких [логических БД](../../../Обзор_понятий_компонентов_и_связей/Основные_понятия/Логическая_база_данных/Логическая_база_данных.md). 
     Возможные префиксы см. в секции [Возможные типы соединений (префиксы JOIN)](#sect_join_prefixes);
3.   `WHERE` — для указания условий выбора данных;
4.   `GROUP BY` — для группировки данных;
5.   `HAVING` — для указания условий выбора сгруппированных данных;
6.   `ORDER BY` — для сортировки данных;
7.   `LIMIT` — для ограничения количества возвращаемых строк;
8.   `OFFSET` — для пропуска указанного количества строк в результате запроса;
9.   <a id="param_datasource_type"></a>`DATASOURCE_TYPE` — для указания [СУБД](../../../Введение/Поддерживаемые_СУБД_хранилища/Поддерживаемые_СУБД_хранилища.md) 
    [хранилища](../../../Обзор_понятий_компонентов_и_связей/Основные_понятия/Хранилище_данных/Хранилище_данных.md), 
    из которой выбираются данные.
     
<a id="sect_for_system_time"></a>
### Ключевое слово FOR SYSTEM_TIME

Ключевое слово `FOR SYSTEM_TIME` позволяет указать момент, по состоянию на который запрашиваются данные,
или период (диапазон дельт), за который запрашиваются изменения. Ключевое слово относится к логической таблице,
логическому представлению или материализованному представлению, после имени которого оно следует. Если в запросе
соединяется несколько логических таблиц и представлений, для каждой логической сущности можно указать свое ключевое слово
`FOR SYSTEM_TIME`, при этом значения этих ключевых слов могут различаться (см. пример [ниже](#ex_different_system_times)).

**Примечание:** наличие и значение ключевого слова `FOR SYSTEM_TIME` для материализованного представления
влияют на порядок маршрутизации запроса (см. раздел [Маршрутизация запросов к данным материализованных представлений](../../../Работа_с_системой/Запрос_данных/Маршрутизация_запросов_к_данным/Маршрутизация_запросов_к_данным.md#sect_mat_view_routing)).

Ключевое слово указывается в формате `FOR SYSTEM_TIME time_expression`, где выражение `time_expression`
принимает одно из следующих значений:
*   `AS OF 'YYYY-MM-DD hh:mm:ss'` — запрос данных, актуальных на указанную дату и время. Возможные форматы
    даты и времени см. в разделе [Форматы даты и времени в запросах](../../Форматы_даты_и_времени_в_запросах/Форматы_даты_и_времени_в_запросах.md);
*   `AS OF DELTA_NUM delta_num` — запрос данных, актуальных на дату и время закрытия дельты
    с номером `delta_num`;
*   `AS OF LATEST_UNCOMMITTED_DELTA` — запрос данных на текущий момент, включая данные, загруженные
    в рамках открытой (горячей) дельты. По горячей дельте возвращаются записи, загруженные в рамках
    непрерывного диапазона завершенных операций записи (см. параметры `cn_from` и `cn_to`
    в разделе [GET_DELTA_HOT](../GET_DELTA_HOT/GET_DELTA_HOT.md));
*   `STARTED IN (delta_num1, delta_num2)` — запрос данных, добавленных или измененных в период
    между дельтой `delta_num1` и дельтой `delta_num2` (включительно);
*   `FINISHED IN (delta_num1, delta_num2)` — запрос данных, удаленных в период между дельтой
    `delta_num1` и дельтой `delta_num2` (включительно).

Следующие значения ключевого слова не поддерживаются в запросах к материализованным представлениям:
* `FOR SYSTEM_TIME AS OF LATEST_UNCOMMITTED_DELTA`;
* `FOR SYSTEM_TIME AS OF STARTED IN (delta_num1, delta_num2)`, если хотя бы одна дельта из диапазона
  отсутствует в материализованном представлении;
* `FOR SYSTEM_TIME AS OF FINISHED IN (delta_num1, delta_num2)`, если хотя бы одна дельта из диапазона
  отсутствует в материализованном представлении.
  
<a id="sect_join_prefixes"></a>
### Поддерживаемые типы соединений (префиксы JOIN)

Поддерживаются следующие типы соединений:
*   `[INNER]` — внутреннее соединение,
*   `NATURAL` — внутреннее соединение по всем столбцам с одинаковыми именами, ключи соединения 
    не указываются,
*   `LEFT [OUTER]` — левое внешнее соединение,
*   `RIGHT [OUTER]` — правое внешнее соединение,
*   `FULL [OUTER]` — полное внешнее соединение,
*   `CROSS` — декартово произведение таблиц или представлений, ключи соединения не указываются.

### Ключевое слово OFFSET

Ключевое слово `OFFSET` позволяет пропустить первые несколько строк результата и выбрать только последующие строки. 
В качестве значения ключевого слова можно указать любое неотрицательное целое число, начиная с нуля. Если для ключевого слова указано 
значение 0, то пропускается 0 строк — это равносильно запросу без ключевого слова `OFFSET`. 

Ключевое слово `OFFSET` можно сочетать с такими ключевыми словами, как `LIMIT` и (или) `ORDER BY`:
* `LIMIT N OFFSET M` — возвращается N строк, начиная со строки с номером M+1 (см. пример [ниже](#offset));
* `ORDER BY column_name OFFSET M` — возвращаются все строки, упорядоченные по значению `column_name`, 
  начиная со строки с номером M+1;
* `ORDER BY column_name LIMIT N OFFSET M` — возвращается N строк, упорядоченных по значению `column_name`, 
  начиная со строки с номером M+1 (см. пример [ниже](#ex_offset_limit_and_order_by)). 
  Такое сочетание ключевых слов позволяет выбирать данные порциями с сохранением их порядка.
  
**Примечание:** если в запросе используется ключевое слово `OFFSET` без `ORDER BY`, в ответе возвращается 
неупорядоченный и потому непредсказуемый набор строк. Для получения предсказуемого результата в запросах 
с ключевым словом `OFFSET` следует добавлять `ORDER BY`.

<!--
## Параметры

*   `column_list` — список выбираемых столбцов таблицы или представления. Допустимо указывать символ `*` 
    для выбора всех столбцов;
*   `db_name` — имя логической базы данных, из которой выбираются данные. Указывается опционально, если 
    выбрана логическая БД, [используемая по умолчанию](../../../Работа_с_системой/Другие_функции/Определение_логической_БД_по_умолчанию/Определение_логической_БД_по_умолчанию.md);
*   `entity_name` — имя таблицы или представления, из которого выбираются данные;
*   `time_expression` — выражение, которое задает момент или период времени, за который выбираются 
    данные или изменения данных. Формат выражения см. [ниже](#sect_for_system_time);
*   `alias_name` — псевдоним таблицы или представления. Может включать латинские буквы, цифры и символы 
    подчеркивания;
*   `datasource_alias` — системный псевдоним СУБД хранилища, из которой выбираются данные. Возможные 
    значения: `'adb'`, `'adqm'`, `'adg'`.
-->

## Ограничения

*   Запрос может обращаться либо к логической БД, либо к сервисной БД (см. [SELECT FROM INFORMATION_SCHEMA](../SELECT_FROM_INFORMATION_SCHEMA/SELECT_FROM_INFORMATION_SCHEMA.md)), 
    но не к обеим одновременно.
*   Если ключами соединения в запросе выступают поля типа Nullable, то строки, где хотя бы один из ключей 
    имеет значение NULL, не соединяются.
*   Для SELECT-подзапроса, указываемого в составе запроса [CREATE MATERIALIZED VIEW](../CREATE_MATERIALIZED_VIEW/CREATE_MATERIALIZED_VIEW.md), 
    не поддерживается ключевое слово `ORDER BY`. 

## Примеры

### Звездочка и WHERE

Запрос с неявным указанием столбцов и ключевым словом `WHERE`:
```sql
SELECT * FROM sales.sales
WHERE store_id = 1234
```

### DATASOURCE_TYPE

Запрос с явным указанием столбцов и выбором данных из определенной СУБД хранилища (ADQM):
```sql
SELECT sold.store_id, sold.product_amount
FROM sales.stores_by_sold_products AS sold
DATASOURCE_TYPE = 'adqm'
```

### GROUP BY, ORDER BY и LIMIT

Запрос с агрегацией, группировкой и сортировкой данных, а также выбором первых 20 строк:
```sql
SELECT s.store_id, SUM(s.product_units) AS product_amount
FROM sales.sales AS s
GROUP BY (s.store_id)
ORDER BY product_amount DESC
LIMIT 20
```

### OFFSET

Запрос с выбором всех строк, начиная с десятой:
```sql
SELECT * from sales.sales OFFSET 9
```

<a id="ex_offset_limit_and_order_by"></a>
### ORDER BY, LIMIT и OFFSET

Запрос 20 строк, упорядоченных по значению `identification_number` и выбираемых начиная с десятой строки 
результата:
```sql
SELECT * from sales.sales ORDER BY identification_number LIMIT 20 OFFSET 9
```

### FOR SYSTEM_TIME AS OF DELTA_NUM

Запрос записей, актуальных на момент закрытия дельты с номером 9, из материализованного представления:
```sql
SELECT * FROM sales.sales_and_stores FOR SYSTEM_TIME AS OF DELTA_NUM 9
```

### Соединение таблиц из разных логических БД

Запрос с соединением данных двух логических таблиц из двух различных логических БД:
```sql
SELECT
  st.identification_number,
  st.category,
  s.product_code
FROM sales.stores FOR SYSTEM_TIME AS OF LATEST_UNCOMMITTED_DELTA AS st
INNER JOIN sales2.sales FOR SYSTEM_TIME AS OF LATEST_UNCOMMITTED_DELTA AS s
  ON st.identification_number = s.store_id
```

### Соединение изменений из разных дельт

<a id="ex_different_system_times"></a>
Запрос с соединением записей логической таблицы, добавленных и измененных в двух различных диапазонах 
дельт:
```sql
-- выбор логической базы данных sales в качестве базы данных по умолчанию
use sales

-- запрос данных из логической таблицы prices
SELECT
  p1.product_code,
  p1.price as feb_price,
  p2.price as march_price,
  (p2.price - p1.price) as diff
FROM
  (SELECT product_code,
  price from sales.prices
  FOR SYSTEM_TIME STARTED IN(3,6)) AS p1
FULL JOIN (select product_code,
  price from sales.prices
  FOR SYSTEM_TIME STARTED IN(7,10)) AS p2
  ON p1.product_code = p2.product_code
WHERE p1.product_code is NOT NULL
ORDER BY diff DESC
LIMIT 50
DATASOURCE_TYPE = 'adb'
```