---
layout: default
title: ROLLBACK DELTA
nav_order: 30
parent: Запросы SQL+
grand_parent: Справочная информация
has_children: false
has_toc: false
---

# ROLLBACK DELTA

Запрос позволяет откатить горячую (открытую) [дельту](../../../overview/main_concepts/delta/delta.md) — 
отменить все изменения горячей дельты и вернуть [логическую базу данных](../../../overview/main_concepts/logical_db/logical_db.md)
в состояние на момент последней закрытой дельты. При откате отменяются все операции записи горячей
дельты: как завершенные, так и еще выполняемые.

**Внимание:** после запуска запроса невозможно закрыть горячую дельту и зафиксировать ее изменения, даже если 
система не смогла откатить дельту и вернула исключение.

При наличии множества параллельных операций записи система не всегда может отменить все операции за один проход.
Если запрос вернул исключение `Can't rollback delta by datamart <db_name>`, это означает, что системе не удалось 
отменить все операции записи горячей дельты. В этом случае необходимо повторить запрос один или несколько раз: до 
получения в ответе номера последней закрытой дельты вместо исключения.

Перед выполнением запроса необходимо определить логическую базу данных, 
[используемую по умолчанию](../../../working_with_system/other_features/default_db_set-up/default_db_set-up.md),
если она еще не определена.

**Примечание:** откат закрытой дельты невозможен.

Откат горячей дельты выполняется в следующем порядке:
1. Останавливаются все выполняемые операции записи: вызванные как функцией 
   [загрузки данных](../../../working_with_system/data_upload/data_upload.md), так и функцией 
   [обновления данных](../../../working_with_system/data_update/data_update.md).
   <br>При этом операции, вызванные функцией загрузки данных, останавливаются асинхронно, и система периодически 
   проверяет, остались ли неостановленные операции записи. Проверка запускается раз в интервал, равный значению 
   параметра `DELTA_ROLLBACK_STATUS_CALLS_MS` в [конфигурации](../../../maintenance/configuration/configuration.md) 
   системы.
2. Отменяются все операции записи горячей дельты: остановленные, завершенные успешно и завершенные с ошибкой. 
   При этом отменяются все связанные изменения данных.
3. Горячая дельта удаляется из [сервисной базы данных](../../../overview/main_concepts/service_db/service_db.md),
   и зарезервированный ранее номер горячей дельты освобождается.

В ответе возвращается:
*   объект ResultSet c одной записью, содержащей номер последней закрытой дельты, при успешном выполнении 
    запроса;
*   исключение при неуспешном выполнении запроса.

## Синтаксис {#syntax}

```sql
ROLLBACK DELTA
```