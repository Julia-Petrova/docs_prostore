---
layout: default
title: Создание материализованного представления
nav_order: 8
parent: Управление схемой данных
grand_parent: Работа с системой
has_children: false
---

# Создание материализованного представления

Чтобы создать [материализованное представление](../../../Обзор_понятий_компонентов_и_связей/Основные_понятия/Материализованное_представление/Материализованное_представление.md) 
в [логической базе данных](../../../Обзор_понятий_компонентов_и_связей/Основные_понятия/Логическая_база_данных/Логическая_база_данных.md), 
выполните запрос [CREATE MATERIALIZED VIEW](../../../Справочная_информация/Запросы_SQLplus/CREATE_MATERIALIZED_VIEW/CREATE_MATERIALIZED_VIEW.md) 
(см. пример [ниже](#пример-запроса-на-создание-материализованного-представления)). При успешном выполнении запроса в 
[логической схеме данных](../../../Обзор_понятий_компонентов_и_связей/Основные_понятия/Логическая_схема_данных/Логическая_схема_данных.md) 
появляется новое материализованное представление.

Чтобы проверить наличие материализованного представления, используйте любой из способов:
*   выполните [запрос метаданных](../Запрос_метаданных_логической_схемы/Запрос_метаданных_логической_схемы.md) 
    логической схемы данных (вместо `DB_NAME` и `MATERIALIZED_VIEW_NAME` подставьте имя логической БД и имя
    представления в верхнем регистре; см. пример [ниже](#пример-запроса-на-проверку-наличия-материализованного-представления)):
    ```sql
    SELECT * FROM INFORMATION_SCHEMA.tables
    WHERE table_schema = '<DB_NAME>' AND
      ((table_name = '<MATERIALIZED_VIEW_NAME>' AND table_type = 'BASE TABLE') OR
       (table_name = 'SYS_<MATERIALIZED_VIEW_NAME>' AND table_type = 'VIEW'))
    ```
*   выполните запрос [SELECT](../../../Справочная_информация/Запросы_SQLplus/SELECT/SELECT.md) к материализованному 
    представлению:
    ```sql
    SELECT * FROM <db_name>.<materialized_view_name>
    ```
*   проверьте дерево объектов в вашем SQL-клиенте (см. рисунок [ниже](#img_mat_view_in_object_tree)).

Если материализованное представление существует, указанный запрос к метаданным возвращает две записи,
запрос к представлению возвращает от ноля до нескольких записей (в зависимости от уровня синхронизации 
представления) и представление отображается среди объектов логической БД в SQL-клиенте. Иначе 
запрос к метаданным возвращает ноль записей, запрос к представлению возвращает исключение 
`Entity <materialized_view_name> does not exist`, и представление отсутствует среди объектов логической БД 
в SQL-клиенте.

На рисунке ниже показан фрагмент дерева объектов, которое содержит материализованное представление `sales_and_stores`, 
в SQL-клиенте.

<a id="img_mat_view_in_object_tree"></a>
![](Материализованное_представление.png){:height="70%" width="70%"}
{: .figure-center}
*Материализованное представление в дереве объектов*
{: .figure-caption-center}

## Примеры

### Пример запроса на создание материализованного представления

```sql
-- выбор базы данных sales по умолчанию
USE sales

-- создание материализованного представления sales_and_stores
CREATE MATERIALIZED VIEW sales.sales_and_stores (
  identification_number INT NOT NULL,
  transaction_date TIMESTAMP NOT NULL,
  product_code VARCHAR(256) NOT NULL,
  product_units INT NOT NULL,
  description VARCHAR(256),
  store_id INT NOT NULL,
  store_category VARCHAR(256) NOT NULL,
  region VARCHAR(256) NOT NULL,
  PRIMARY KEY (identification_number, region)
)
DISTRIBUTED BY (identification_number)
DATASOURCE_TYPE (adg)
AS SELECT
 s.identification_number, s.transaction_date, s.product_code, s.product_units, s.description,
 st.identification_number AS store_id, st.category as store_category, st.region
 FROM sales.sales AS s
 JOIN sales.stores AS st
 ON s.store_id = st.identification_number
DATASOURCE_TYPE = 'adb'
```

### Пример запроса на проверку наличия материализованного представления

```sql
-- проверка наличия материализованного представления sales_and_stores
SELECT
  CASE
    WHEN count(*) > 1 THEN 'представление существует'
    ELSE 'представление не существует'
  END
FROM INFORMATION_SCHEMA.tables
WHERE table_schema = 'SALES' AND 
    ((table_name = 'SALES_AND_STORES' AND table_type = 'BASE TABLE') OR 
     (table_name = 'SYS_SALES_AND_STORES' AND table_type = 'VIEW'))
```